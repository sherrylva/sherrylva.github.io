<html id="scene">
<script src='https://d3js.org/d3.v5.min.js'></script>
<style></style>
<h1>Exploring the World's Population</h1>>
<button onClick="goToSlide1()">1</button>
<button onClick="goToSlide2()">2</button>
<button onClick="goToSlide3()">3</button>
<script>
    
</script>
<style>
    #svg rect {
        fill:rebeccapurple
    }
    #chart-title{
        font-size: large;
        font-weight: bolder;
    }
    * {
        text-align: center;
    }
</style>
<div id="chart-title">World Population By Region</div>
<!-- <div id="chart"> -->
<select id="dropdown" onchange="dropdownChange(this.value);"></select>
<svg id="svg">
</svg>
<!-- </div> -->


<script>
   
    popMap = new Map()
    urbanMap = new Map()
    areaMap = new Map()
    countries = []

    loadCountriesData(); //basically loads first scene

  
    function dropdownChange(country){
        d3.select('#svg').selectAll("*").remove();
        console.log(popMap)
        countryPopulation = popMap.get(country);
        urbanPopulation = urbanMap.get(country);
        console.log(countryPopulation)
    
        // max = Math.max(...population)
        population = [countryPopulation, urbanPopulation]
        domains = ["Total Population", "Urban Population"]
        var x = d3.scaleBand().domain(domains).range([0, 700]);
        var y = d3.scaleLinear().domain([0, countryPopulation]).range([350, 0]);
        
        d3.select("svg").attr("width", 900).attr("height", 550).append("g").attr("transform", "translate(100,100)")
        .selectAll("rect").data(population).enter().append("rect")
        .attr("x", function(d,i){return 125 + x(domains[i])})
        .attr("y", function(d){return y(d)})
        .attr("width", function(d,i){return 100})
        .attr("height", function(d){return 350 - y(d)})
        // .on("mouseover", mouseover)
        // .on("mousemove", mousemove);

        d3.select("svg").append("g").attr("transform", "translate(100,100)").call(d3.axisLeft(y));
        d3.select("svg").append("g").attr("transform", "translate(100, 450)").call(d3.axisBottom(x)).selectAll("text")  
        .style("text-anchor", "end")
        .attr("transform", "rotate(-55)");

        // console.log(country);
        // console.log(popMap.get(country));
        // console.log(urbanMap.get(country));
    }
    async function loadCountriesData(){
        document.getElementById("dropdown").style.visibility = "hidden";
        const data = await d3.csv("https://gist.githubusercontent.com/sherrylva/c2dfa8eb761c7053ed28d256d818b31e/raw/6ce7406f2d6234db6a4651b455e7cd46f7239ed4/countries.csv");
       
        createFirstScene(data)
    }
    async function loadPopulationData(){
        const data = await d3.csv("https://gist.githubusercontent.com/sherrylva/dc0988dacc1dde3b7b6392b4a1565db0/raw/519d622af85090325ec3bec38d23565c8facd1bd/worldPopulation.csv");
        createThirdScene(data);
    }
    function createThirdScene(data){
       
        for(var i = 0; i < data.length; i++){
            const country = data[i].Country;
            const pop = parseInt(data[i].Population);
            const urban = parseInt(data[i].Urban)
            // const area = parseInt(data[i].Area) //km square

            var urbanPop = Math.ceil((urban/100) * pop);
            if(isNaN(urban)){
                urbanPop = 0;
            }
            countries.push(data[i].Country);
            popMap.set(country, pop)
            urbanMap.set(country, urbanPop);
            // areaMap.set(country, area);

            var dropdown = document.getElementById("dropdown");
            var option = document.createElement("option")
            option.text = country;
            option.value = country;
            dropdown.add(option);
        }
        dropdownChange(dropdown.value);
    }

    function createFirstScene(data){
        const mapPop = new Map();
        const mapNumCountries = new Map();
        for(var i = 0; i < data.length; i++){
            const region = data[i].Region;
            const population = parseInt(data[i].Population)
            if(mapPop.get(region) === undefined){
                mapPop.set(region, 0);
            }
            if(mapNumCountries.get(region) === undefined){
                mapNumCountries.set(region, 0);
            }
            if(mapPop !== undefined){
                mapPop.set(region, mapPop.get(region) + population);
            }
            if(mapNumCountries.get(region) !== undefined){
                mapNumCountries.set(region, mapNumCountries.get(region) + 1);
            }
        }
        const sortedMap = new Map([...mapPop.entries()].sort((a, b) => b[1] - a[1]));
        console.log(sortedMap);
        console.log(mapNumCountries);
        regions = []
        population = []
        for (let key of sortedMap.keys()) {
            regions.push(key);
            population.push(sortedMap.get(key));
        }
        max = Math.max(...population)
        var x = d3.scaleBand().domain(regions).range([0, 700]);
        var y = d3.scaleLinear().domain([0, max]).range([350, 0]);
        console.log(y(4))
        d3.select("svg").attr("width", 900).attr("height", 550).append("g").attr("transform", "translate(100,100)")
        .selectAll("rect").data(population).enter().append("rect")
        .attr("x", function(d,i){return x(regions[i])})
        .attr("y", function(d){return y(d)})
        .attr("width", function(d,i){return 50})
        .attr("height", function(d){return 350 - y(d)})
        // .on("mouseover", mouseover)
        // .on("mousemove", mousemove);

        d3.select("svg").append("g").attr("transform", "translate(100,100)").call(d3.axisLeft(y));
        d3.select("svg").append("g").attr("transform", "translate(100, 450)").call(d3.axisBottom(x)).selectAll("text")  
        .style("text-anchor", "end")
        .attr("transform", "rotate(-55)");
    }


    async function createSecondScene(){
        const data = await d3.csv("https://gist.githubusercontent.com/sherrylva/dc0988dacc1dde3b7b6392b4a1565db0/raw/519d622af85090325ec3bec38d23565c8facd1bd/worldPopulation.csv");

        // maxArea = d3.max(data, function(d){return d.Area})
        map = new Map();
        for(var i = 0; i < data.length; i++){
            const country = data[i].Country;
            const population = parseInt(data[i].Population)
            map.set(country, population)
            }
            const sortedMap = new Map([...map.entries()].sort((a, b) => b[1] - a[1]));
        // maxPop = d3.max(data, function(d){return d.Population})
        let counter = 0;
        countries_second_scene = []
        populations_second_scene = []
        for (let key of sortedMap.keys()) {
            if(counter < 25){
                countries_second_scene.push(key);
                populations_second_scene.push(sortedMap.get(key));
            }
            counter = counter + 1

        }

        console.log(countries_second_scene);
        console.log(populations_second_scene);
        max = Math.max(...populations_second_scene)
        var x = d3.scaleBand().domain(countries_second_scene).range([0, 700]);
        var y = d3.scaleLinear().domain([0, max]).range([350, 0]);

        d3.select("svg").attr("width", 900).attr("height", 550).append("g").attr("transform", "translate(100,100)")
        .selectAll("rect").data(populations_second_scene).enter().append("rect")
        .attr("x", function(d,i){return x(countries_second_scene[i])})
        .attr("y", function(d){return y(d)})
        .attr("width", function(d,i){return 25})
        .attr("height", function(d){return 350 - y(d)})
        // .on("mouseover", mouseover)
        // .on("mousemove", mousemove);

        d3.select("svg").append("g").attr("transform", "translate(100,100)").call(d3.axisLeft(y));
        d3.select("svg").append("g").attr("transform", "translate(100, 450)").call(d3.axisBottom(x)).selectAll("text")  
        .style("text-anchor", "end")
        .attr("transform", "rotate(-55)");

    }

    function createBarChart(data){
        const map = new Map();
        for(var i = 0; i < data.length; i++){
            const state = data[i].state;
            const cases = parseInt(data[i].cases)
            if(map.get(state) === undefined){
                map.set(state, 0);
            }
            if(cases !== undefined){
                map.set(state, map.get(state) + cases);
            }
        }
        const sortedMap = new Map([...map.entries()].sort((a, b) => b[1] - a[1]));
        // console.log(sortedMap);
        states = []
        cases = []
        for (let key of sortedMap.keys()) {
            states.push(key);
            cases.push(map.get(key));
        }
        // console.log(states)
        // console.log(cases)
        data = [4, 6, 5];
        min = Math.min(...cases)
        max = Math.max(...cases)

        // var tooltip = d3.select('.tooltip-area')
        // .style('opacity', 0);
        // var mouseover = function(d) {
        //     console.log("hi");
        //     tooltip.style("opacity", 1)
        // }
        // var mousemove = function(d) {
        //     console.log("move")
        //     tooltip.style('opacity', 0);
        //     // tooltip
        //     // .style("left", (d3.mouse(this)[0]+90) + "px") // It is important to put the +90: other wise the tooltip is exactly where the point is an it creates a weird effect
        //     // .style("top", (d3.mouse(this)[1]) + "px")
        // }
        // console.log(data.length)
        // console.log(max)
        //var domain = createDomain(cases.length)
        var x = d3.scaleBand().domain(states).range([0, 1200]);
        var y = d3.scaleLinear().domain([0, max]).range([350, 0]);
        console.log(y(4))
        d3.select("svg").attr("width", 1300).attr("height", 550).append("g").attr("transform", "translate(50,50)")
        .selectAll("rect").data(cases).enter().append("rect")
        .attr("x", function(d,i){return x(states[i])})
        .attr("y", function(d){return y(d)})
        .attr("width", function(d,i){return 15})
        .attr("height", function(d){return 350 - y(d)})
        // .on("mouseover", mouseover)
        // .on("mousemove", mousemove);

        d3.select("svg").append("g").attr("transform", "translate(50,50)").call(d3.axisLeft(y));
        d3.select("svg").append("g").attr("transform", "translate(50, 400)").call(d3.axisBottom(x)).selectAll("text")  
        .style("text-anchor", "end")
        .attr("transform", "rotate(-65)");

    }

    async function goToSlide1(){
        d3.select('#svg').selectAll("*").remove();
        document.getElementById("dropdown").style.visibility = "hidden";
        loadCountriesData() // Loads the data and creates the first scene chart as well
    }
    function goToSlide2(){
        document.getElementById("dropdown").style.visibility = "hidden";
        d3.selectAll("svg > *").remove();
        createSecondScene()
    }
    function goToSlide3(){
        d3.selectAll("svg > *").remove();
        document.getElementById("dropdown").style.visibility = "visible";
        loadPopulationData() // creates chart as well
    }
</script>
</html>
